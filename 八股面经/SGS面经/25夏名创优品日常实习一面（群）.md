# 25 夏京东物流日常实习一面 30 min

## 自我介绍

## 项目八股拷打

### 在线学习平台：Redis 实现设备级互斥登录（单设备登录控制）

- **背景**：为保障用户账号安全，需要实现「一个账号同一时间仅允许一台设备登录」的能力。由于采用前后端分离架构（Vue + Spring Boot），使用了 JWT 作为登录态凭证，存在 Token 无状态、不可主动失效的问题。

#### 业务要求

- 限制同一用户账号同时只能登录一个设备（设备级登录互斥）。

- 支持未来拓展到「最多 N 台设备同时在线」的场景。

- 支持滑动过期策略：用户持续活跃时延长会话有效时间。

#### 解决方法

1. 登录时为用户颁发新的 JWT，保存到前端本地，并同步保存至 Redis（Key 为用户 ID，Value 为 JWT）。

2. 用户访问后端接口时，需经过两步校验：

   - 校验 JWT 合法性（签名、过期等）；

   - 校验 JWT 是否与 Redis 中当前记录一致，若不一致即为旧 Token，视为强制下线。

3. 若扩展为支持多设备登录：

   - 将 Redis 中的单值结构改为 List；

   - 登陆时将 JWT 入队，超出 N 条时淘汰最早的 Token；

   - 校验时判断当前 JWT 是否存在于 Redis List 中。

4. 实现滑动过期机制：

   - 每次用户请求时重新生成新 JWT，并覆盖 Redis 中的旧值；

   - 新 JWT 延长过期时间，维持登录状态。

### RabbitMQ 异步化评论/点赞操作与审核机制

- **背景**：系统中存在评论、点赞、回复等用户行为，为降低数据库写压力，提高系统吞吐量，引入 RabbitMQ 进行异步处理。同时，在新增「评论审核机制」后，需要对用户内容进行审核后再展示。

#### 业务要求

- 评论等内容需经过审核后才可被用户看到；

- 保证高并发下的点赞/评论等操作对系统性能影响最小。

#### 解决方法

1. 用户行为如点赞、评论等，发送至 RabbitMQ 消息队列，不直接写数据库。

2. 对于评论/回复内容：

   - 添加审核流程模块；
   - 评论先投递至队列，进入审核模块（可对接 AI 内容审核或人工）；
   - 审核通过后写入数据库，同时触发通知模块通知相关用户。

3. 异步处理带来的性能优化：

   - 避免数据库高频写入；
   - 在本地压测中发现原同步写入方式对主机性能影响较大，引入 MQ 后系统稳定性提升明显。

### Redis 缓存优化与热 Key 问题处理

- **背景**：用户信息模块频繁被访问，导致数据库压力大，需引入 Redis 缓存用户信息。但由于用户栏为热点区域，缓存 Key 存在成为 Redis 热 Key 的风险。

#### 业务要求

- 减少数据库频繁访问，提升响应速度；
- 缓解 Redis 热 Key 导致单节点流量倾斜的问题。

#### 解决方法

1. 使用 Redis 缓存用户信息（如用户昵称、头像等）；

2. 发现缓存成为热 Key 后，提出以下优化思路：

   - 通过在 Redis 层进行数据分片或加随机后缀打散 Key；

   - 考虑使用 Redis Cluster 模式分散热 Key；

   - 或结合 CDN、本地缓存（Guava、Caffeine）进行二级缓存。
